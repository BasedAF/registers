<head>
    <script src="jquery-3.3.1.min.js"></script>
    <script src="./register.js"></script>
    <!-- <script>window.jQuery || 
    document.write("<script src='./jquery/jquery-3.3.1.min.js'><\/script>");</script> -->
    <style>
        .inc, .deb {
            display: none;
        }
        table {
            width: 50%;
        }
        th {
            /* align-content: center; */
            border: 1px solid black;
            /* display: inline-table; */
            padding: 1%;
            text-align: left;
        }
        td {
            /* align-content: center; */
            /* align-items: center; */
            border: 1px solid black;
            /* display: inline-table */
            text-align: center;
        }
        .active {
            background-color: blanchedalmond;
        }
    </style>
</head>
<body>
    <div id="program-container">
        <table class="program">
            <tr class="program-header">
                <th class="program-column-head">Line</th>
                <th class="program-column-head">Operation</th>
                <th class="program-column-head">Register</th>
                <th class="program-column-head">Next Line</th>
                <th class="program-column-head">Branch Line</th>
            </tr>
            <tr class="line" id="line-prototype" style="display: none;">
                <td class="line-num-cell">
                    <h3 class="line-num">0</h3>
                </td>
                <td class="op-cell">
                    <select class="op-select">
                        <option value="END" class="op">END</option>
                        <option value="INC" class="op">INC</option>
                        <option value="DEB" class="op">DEB</option>
                    </select>
                </td>
                <td class="inc reg-cell" style="display: none;">
                    <input type="number" class="reg" min='1' />
                </td>
                <td class="inc next-cell" style="display: none;">
                    <input type="number" class="next" min='1' />
                </td>
                <td class="deb alt-cell" style="display: none;">
                    <input type="number" class="alt" min='1' />
                </td>
                <button type="button" class="delete-line">Delete line</button>
            </tr>
        </table>
        <button type="button" class="add-line">Add new line</button>
        
    </div>
    <!-- <div id="display-container">
        <div id="display">
        </div>
    </div> -->
    <script>
        function readProgram(src) {
            // Assumes SRC is a DOM element with a series of items of class "line"
            var $src = $(src);
            var instructions = [];
            $src.find(".line").each(function (index, line) {
                var op = line.find("select").value;
                var instruction;
                if (op == "END") {
                    instruction = RegisterInstruction(op);
                } else {
                    var reg = line.find(".reg").value;
                    var next = line.find(".next").value;
                    instruction = (op == "DEB") ?
                        RegisterInstruction(op, reg, next, line.find(".alt").value) :
                        RegisterInstruction(op, reg, next);
                }
                instructions.push(instruction);
            });
            return instructions;
        }
        var globalLines_ = 0;
        function addLine(container) {
            // Adds a blank line of code to the interface.
            var line = $(container).find("#line-prototype").clone(true, true).removeAttr("id");
            line.find(".line-num").text(++globalLines_);
            // (".op-select").on("change", function (event) {
            //     // var line = $(this).parent().parent();
            //     var val = this.value;
            //     if (val == "END") {
            //         line.find(".inc, .deb").hide();
            //     } else {
            //         line.find(".inc").show();;
            //         if (val == "DEB") {
            //             line.find(".deb").show();
            //         } else {
            //             line.find(".deb").hide();
            //         }
            //     }
            // });
            container.find(".program").append(line.show());
            // line.show();
        }

        $(".add-line").on("click", function (event) {
            event.preventDefault();
            addLine($(this).parent());
        });
        $(".remove-line").on("click", function (event) {
            event.preventDefault();
            $(this).parent().remove();
        });
        $(".op-select").on("change", function(event){
            var line = $(this).parent().parent();
            var val = this.value;
            if (val == "END") {
                line.find(".inc, .deb").hide();
            } else {
                line.find(".inc").show();;
                if (val == "DEB") {
                    line.find(".deb").show();
                } else {
                    line.find(".deb").hide();
                }
            }
        });
    </script>
</body>